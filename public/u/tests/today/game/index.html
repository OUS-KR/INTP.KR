<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 게임 - INTP</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <style>
        .game-container {
            max-width: 700px;
            margin: 2em auto;
            padding: 2em;
            background-color: var(--card-bg-color);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            text-align: center;
        }
        .game-area {
            margin-top: 1.5em;
            min-height: 200px; /* Ensure consistent height */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .sequence-display, .pattern-display, .scramble-display {
            font-size: 2em;
            margin-bottom: 1em;
            font-weight: bold;
            color: var(--text-color);
        }
        .sequence-display span, .pattern-display span {
            margin: 0 0.3em;
            padding: 0.1em 0.4em;
            border-radius: 4px;
            background-color: var(--primary-color-light);
            color: var(--primary-color-dark);
        }
        .sequence-display .missing, .pattern-display .missing {
            background-color: var(--accent-color);
            color: var(--text-color-inverted);
        }
        .scramble-display {
            letter-spacing: 0.1em;
        }
        .game-input {
            margin-bottom: 1em;
        }
        .game-input input[type="text"], .game-input input[type="number"] {
            padding: 0.5em;
            font-size: 1.2em;
            width: 150px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--input-bg-color);
            color: var(--text-color);
            text-align: center;
        }
        .game-input button {
            padding: 0.6em 1.5em;
            font-size: 1.1em;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-left: 0.5em;
        }
        .game-input button:hover {
            background-color: var(--primary-color-dark);
        }
        .feedback-message {
            margin-top: 1em;
            font-size: 1.2em;
            font-weight: bold;
        }
        .feedback-message.correct {
            color: var(--success-color);
        }
        .feedback-message.incorrect {
            color: var(--error-color);
        }
        .new-game-button {
            margin-top: 1.5em;
            padding: 0.8em 2em;
            font-size: 1.1em;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .new-game-button:hover {
            background-color: var(--secondary-color-dark);
        }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">INTP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links">
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">오늘의 콘텐츠</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/today/fortune/">오늘의 운세</a>
                        <a href="/u/tests/today/game/">오늘의 게임</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">정보</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/info-characteristics/">특징</a>
                        <a href="/u/tests/info-careers/">커리어</a>
                        <a href="/u/tests/info-cognitive-functions/">인지기능</a>
                        <a href="/u/tests/info-subtypes/">하위유형</a>
                        <a href="/u/tests/info-relationships/">인간관계</a>
                        <a href="/u/tests/info-misconceptions/">흔한 오해</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">테스트</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/test-logic-quiz/">논리력 퀴즈</a>
                        <a href="/u/tests/test-relationship-style/">연애 스타일 테스트</a>
                        <a href="/u/tests/test-stress-triggers/">스트레스 테스트</a>
                        <a href="/u/tests/test-brain-utilization/">두뇌 활용 테스트</a>
                        <a href="/u/tests/test-bingo/">빙고 챌린지</a>
                        <a href="/u/tests/test-empathy-quiz/">INTP 공감 퀴즈</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">게임</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/game-logic-puzzle/">논리 퍼즐</a>
                        <a href="/u/tests/game-strategy-simulation/">전략 시뮬레이션</a>
                        <a href="/u/tests/game-code-decryption/">기억력 게임</a>
                        <a href="/u/tests/game-abstract-reasoning/">추상적 사고 게임</a>
                        <a href="/u/tests/game-travel-planner/">여행 계획 챌린지</a>
                        <a href="/u/tests/game-maze-challenge/">미로 챌린지</a>
                        <a href="/u/tests/game-code-breaker/">암호 해독기</a>
                        <a href="/u/tests/game-pathfinder/">경로 탐색기</a>
                    </div>
                </div>
            </nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1 id="gameTitle">오늘의 INTP 게임</h1>
        <div class="game-container">
            <p id="gameDescription">게임을 불러오는 중...</p>
            <div id="gameArea" class="game-area">
                <!-- Game content will be loaded here by JavaScript -->
            </div>
            <div class="game-input">
                <input type="text" id="userGuess" placeholder="정답 입력" autofocus>
                <button id="submitGuess">제출</button>
            </div>
            <p id="feedbackMessage" class="feedback-message"></p>
            <button id="newGameButton" class="new-game-button" style="display:none;">새로운 게임</button>
        </div>
    </div>

    <script src="/assets/js/main.js" defer></script>
    <script>
        function getDailySeed() {
            const today = new Date();
            return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
        }

        function mulberry32(seed) {
            return function() {
                seed |= 0;
                seed = seed + 0x6D2B79F5 | 0;
                let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
                t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }

        let currentCorrectAnswer = null;
        let currentRandFn = null;

        // --- Game Implementations ---

        // Game Type 0: Number Sequence Guessing Game
        function setupNumberSequenceGame() {
            document.getElementById('gameTitle').innerText = "오늘의 INTP 게임: 숫자 시퀀스 추론";
            document.getElementById('gameDescription').innerText = "주어진 숫자 시퀀스의 다음 숫자를 추론해 보세요. 당신의 논리력을 시험할 시간입니다!";
            document.getElementById('userGuess').type = "number";
            document.getElementById('userGuess').placeholder = "다음 숫자";

            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '<div id="sequenceDisplay" class="sequence-display"></div>';

            const { sequence, nextNum } = generateNumberSequence(currentRandFn);
            currentCorrectAnswer = nextNum;
            displayNumberSequence(sequence);
        }

        function generateNumberSequence(randFn) {
            const type = Math.floor(randFn() * 3); // 0: arithmetic, 1: geometric, 2: Fibonacci-like
            const start = Math.floor(randFn() * 10) + 1; // 1-10
            const length = 5; // 5 numbers in sequence
            let sequence = [];
            let nextNum = 0;

            if (type === 0) { // Arithmetic progression
                const diff = Math.floor(randFn() * 5) + 1; // 1-5
                for (let i = 0; i < length; i++) {
                    sequence.push(start + i * diff);
                }
                nextNum = start + length * diff;
            } else if (type === 1) { // Geometric progression
                const ratio = Math.floor(randFn() * 3) + 2; // 2-4
                for (let i = 0; i < length; i++) {
                    sequence.push(start * Math.pow(ratio, i));
                }
                nextNum = start * Math.pow(ratio, length);
            } else { // Fibonacci-like
                let a = start;
                let b = start + Math.floor(randFn() * 5) + 1;
                sequence.push(a, b);
                for (let i = 2; i < length; i++) {
                    let c = a + b;
                    sequence.push(c);
                    a = b;
                    b = c;
                }
                nextNum = a + b;
            }
            return { sequence, nextNum };
        }

        function displayNumberSequence(sequence) {
            const display = document.getElementById('sequenceDisplay');
            display.innerHTML = '';
            sequence.forEach((num) => {
                const span = document.createElement('span');
                span.innerText = num;
                display.appendChild(span);
            });
            const missingSpan = document.createElement('span');
            missingSpan.innerText = '?';
            missingSpan.classList.add('missing');
            display.appendChild(missingSpan);
        }

        // Game Type 1: Simple Pattern Matching Game
        const patterns = [
            { question: "▲ ▼ ▲ ?", answer: "▼", display: ["▲", "▼", "▲", "?"] },
            { question: "A B D G ?", answer: "K", display: ["A", "B", "D", "G", "?"] },
            { question: "1 1 2 3 5 ?", answer: "8", display: ["1", "1", "2", "3", "5", "?"] },
            { question: "O T T F F S S ?", answer: "E", display: ["O", "T", "T", "F", "F", "S", "S", "?"] } // One, Two, Three, Four, Five, Six, Seven, Eight
        ];

        function setupPatternMatchingGame() {
            document.getElementById('gameTitle').innerText = "오늘의 INTP 게임: 패턴 인식";
            document.getElementById('gameDescription').innerText = "주어진 패턴의 다음 요소를 찾아보세요. 숨겨진 규칙을 발견할 수 있을까요?";
            document.getElementById('userGuess').type = "text";
            document.getElementById('userGuess').placeholder = "다음 요소";

            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '<div id="patternDisplay" class="pattern-display"></div>';

            const patternIndex = Math.floor(currentRandFn() * patterns.length);
            const selectedPattern = patterns[patternIndex];
            currentCorrectAnswer = selectedPattern.answer;
            displayPattern(selectedPattern.display);
        }

        function displayPattern(patternArray) {
            const display = document.getElementById('patternDisplay');
            display.innerHTML = '';
            patternArray.forEach((item) => {
                const span = document.createElement('span');
                span.innerText = item;
                if (item === '?') {
                    span.classList.add('missing');
                }
                display.appendChild(span);
            });
        }

        // Game Type 2: Word Scramble (INTP-themed)
        const intpWords = [
            { word: "LOGIC", hint: "INTP의 핵심 사고 방식" },
            { word: "ANALYZE", hint: "INTP가 즐겨하는 활동" },
            { word: "THEORY", hint: "INTP가 탐구하는 것" },
            { word: "INNOVATE", hint: "INTP의 창의성" },
            { word: "SYSTEM", hint: "INTP가 이해하려는 것" }
        ];

        function shuffleWord(word, randFn) {
            let a = word.split("");
            let n = a.length;

            for(let i = n - 1; i > 0; i--) {
                let j = Math.floor(randFn() * (i + 1));
                let tmp = a[i];
                a[i] = a[j];
                a[j] = tmp;
            }
            return a.join("");
        }

        function setupWordScrambleGame() {
            document.getElementById('gameTitle').innerText = "오늘의 INTP 게임: 단어 스크램블";
            document.getElementById('gameDescription').innerText = "섞인 글자들을 조합하여 INTP와 관련된 단어를 맞춰보세요! (힌트: INTP 관련)";
            document.getElementById('userGuess').type = "text";
            document.getElementById('userGuess').placeholder = "정답 단어";

            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '<div id="scrambleDisplay" class="scramble-display"></div><p id="scrambleHint" style="font-style: italic; margin-top: 1em;"></p>';

            const wordIndex = Math.floor(currentRandFn() * intpWords.length);
            const selectedWord = intpWords[wordIndex];
            currentCorrectAnswer = selectedWord.word.toUpperCase();
            document.getElementById('scrambleDisplay').innerText = shuffleWord(selectedWord.word.toUpperCase(), currentRandFn);
            document.getElementById('scrambleHint').innerText = "힌트: " + selectedWord.hint;
        }

        // --- Game Dispatcher and Common Logic ---

        const gameTypes = [
            setupNumberSequenceGame,
            setupPatternMatchingGame,
            setupWordScrambleGame
        ];

        function checkGuess() {
            const userGuess = document.getElementById('userGuess').value.trim();
            const feedbackMessage = document.getElementById('feedbackMessage');
            const submitButton = document.getElementById('submitGuess');
            const newGameButton = document.getElementById('newGameButton');
            const guessInput = document.getElementById('userGuess');

            if (userGuess === "") {
                feedbackMessage.innerText = "정답을 입력해 주세요!";
                feedbackMessage.className = "feedback-message incorrect";
                return;
            }

            // For number sequence, convert to number for comparison
            let guessToCompare = userGuess;
            if (document.getElementById('userGuess').type === "number") {
                guessToCompare = parseInt(userGuess);
            }

            if (guessToCompare.toString().toUpperCase() === currentCorrectAnswer.toString().toUpperCase()) {
                feedbackMessage.innerText = "정답입니다! 당신의 논리력은 완벽하군요.";
                feedbackMessage.className = "feedback-message correct";
                submitButton.disabled = true;
                guessInput.disabled = true;
                newGameButton.style.display = 'block';

                // Special handling for number sequence to reveal answer
                if (document.getElementById('sequenceDisplay')) {
                    const display = document.getElementById('sequenceDisplay');
                    display.lastChild.innerText = currentCorrectAnswer;
                    display.lastChild.classList.remove('missing');
                }
            } else {
                feedbackMessage.innerText = "오답입니다. 다시 시도해 보세요!";
                feedbackMessage.className = "feedback-message incorrect";
            }
        }

        function initDailyGame() {
            const seed = getDailySeed();
            currentRandFn = mulberry32(seed);

            const gameTypeIndex = Math.floor(currentRandFn() * gameTypes.length);
            gameTypes[gameTypeIndex](); // Setup the selected game type

            document.getElementById('userGuess').value = '';
            document.getElementById('userGuess').disabled = false;
            document.getElementById('submitGuess').disabled = false;
            document.getElementById('feedbackMessage').innerText = '';
            document.getElementById('feedbackMessage').className = "feedback-message";
            document.getElementById('newGameButton').style.display = 'none';
        }

        window.onload = function() {
            initDailyGame();
            document.getElementById('submitGuess').addEventListener('click', checkGuess);
            document.getElementById('userGuess').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    checkGuess();
                }
            });
            document.getElementById('newGameButton').addEventListener('click', initDailyGame);
        };
    </script>
</body>
</html>