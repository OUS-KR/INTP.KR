<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>암호 해독 (크립토그램)</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <style>
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        #cryptogram-quote {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
            font-size: 1.4em;
            letter-spacing: 2px;
            text-align: center;
        }
        .char-wrapper {
            display: inline-block;
            text-align: center;
            margin: 0 2px;
            min-width: 20px;
        }
        .cipher-char {
            font-weight: bold;
            color: var(--h-color);
            display: block;
        }
        .plain-char {
            border-bottom: 2px solid var(--text-color);
            min-height: 24px;
            display: block;
            color: var(--success-color);
            font-weight: normal;
        }
        .mapping-container {
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }
        .alphabet-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            padding: 10px;
            border-radius: 8px;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
        }
        .alphabet-bar:first-child { margin-bottom: 10px; }
        .alphabet-char {
            width: 35px;
            height: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid var(--card-border);
            transition: background-color 0.2s, color 0.2s;
        }
        .alphabet-char:hover { background-color: var(--nav-link-hover); }
        .alphabet-char.selected { background-color: var(--h-color); color: var(--card-bg); }
        .alphabet-char.used { background-color: var(--card-border); color: var(--text-secondary-color); cursor: not-allowed; }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        #message {
            width: 100%;
            text-align: center;
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
            min-height: 25px;
        }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">INTP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links">
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">오늘의 INTP</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/daily/">메인</a>
                        <a href="/u/tests/daily/quote/">오늘의 명언</a>
                        <a href="/u/tests/daily/puzzle/">오늘의 논리 퍼즐</a>
                        <a href="/u/tests/daily/thought-experiment/">오늘의 사고실험</a>
                        <a href="/u/tests/daily/weakness-workout/">INTP 약점 단련</a>
                        <a href="/u/tests/daily/featured-idea/">오늘의 아이디어</a>
                        <a href="/u/tests/daily/de-stressor/">오늘의 스트레스 해소법</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">정보</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/info-characteristics/">특징</a>
                        <a href="/u/tests/info-careers/">커리어</a>
                        <a href="/u/tests/info-cognitive-functions/">인지기능</a>
                        <a href="/u/tests/info-subtypes/">하위유형</a>
                        <a href="/u/tests/info-relationships/">인간관계</a>
                        <a href="/u/tests/info-misconceptions/">흔한 오해</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">테스트</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/test-logic-quiz/">논리력 퀴즈</a>
                        <a href="/u/tests/test-relationship-style/">연애 스타일 테스트</a>
                        <a href="/u/tests/test-stress-triggers/">스트레스 테스트</a>
                        <a href="/u/tests/test-brain-utilization/">두뇌 활용 테스트</a>
                        <a href="/u/tests/test-bingo/">빙고 챌린지</a>
                        <a href="/u/tests/test-empathy-quiz/">INTP 공감 퀴즈</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">게임</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/game-logic-puzzle/">논리 퍼즐</a>
                        <a href="/u/tests/game-strategy-simulation/">전략 시뮬레이션</a>
                        <a href="/u/tests/game-code-decryption/">암호 해독</a>
                        <a href="/u/tests/game-abstract-reasoning/">추상적 사고 게임</a>
                        <a href="/u/tests/game-travel-planner/">여행 계획 챌린지</a>
                        <a href="/u/tests/game-maze-challenge/">미로 챌린지</a>
                        <a href="/u/tests/game-code-breaker/">암호 해독기</a>
                        <a href="/u/tests/game-pathfinder/">경로 탐색기</a>
                    </div>
                </div>
            </nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>
    <div class="container">
        <h1>암호 해독 (크립토그램)</h1>
        <p style="text-align:center;">암호문을 보고 알파벳 치환 규칙을 추리하여 원본 메시지를 찾아보세요.</p>
        
        <div class="game-container">
            <div id="cryptogram-quote"></div>
            <div class="mapping-container">
                <p style="text-align:center; margin-bottom: 5px;"><b>암호 알파벳</b> (클릭하여 선택)</p>
                <div id="cipher-alphabet" class="alphabet-bar"></div>
                <p style="text-align:center; margin-top: 15px; margin-bottom: 5px;"><b>원본 알파벳</b> (선택된 암호 알파벳에 매핑)</p>
                <div id="plain-alphabet" class="alphabet-bar"></div>
            </div>
            <div class="controls">
                <button id="check-btn" class="btn btn-primary">정답 확인</button>
                <button id="hint-btn" class="btn">힌트</button>
                <button id="reset-btn" class="btn">초기화</button>
                <button id="next-puzzle-btn" class="btn" style="display: none;">다음 문제</button>
            </div>
            <div id="message"></div>
        </div>
    </div>

    <script src="/assets/js/main.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const quoteElement = document.getElementById('cryptogram-quote');
            const cipherAlphabetElement = document.getElementById('cipher-alphabet');
            const plainAlphabetElement = document.getElementById('plain-alphabet');
            const checkBtn = document.getElementById('check-btn');
            const resetBtn = document.getElementById('reset-btn');
            const hintBtn = document.getElementById('hint-btn');
            const nextPuzzleBtn = document.getElementById('next-puzzle-btn');
            const messageElement = document.getElementById('message');

            const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const quotes = [
                "LOGIC IS MY PLAYGROUND", "I THINK THEREFORE I AM", "KNOWLEDGE IS POWER",
                "QUESTION EVERYTHING", "ANALYSIS OVER EMOTION", "THE ARCHITECT OF IDEAS",
                "CURIOSITY IS MY COMPASS", "PATTERNS EMERGE FROM CHAOS",
                "A MIND IS A TERRIBLE THING TO WASTE", "INTROVERTED INTUITIVE THINKING PERCEIVING",
                "THE WORLD IS A COMPLEX SYSTEM TO BE UNDERSTOOD", "I NEED SOLITUDE TO RECHARGE MY MIND",
                "ENDLESS CURIOSITY FOR THE WIN", "SARCASM IS MY SECOND LANGUAGE",
                "OVERTHINKING IS MY DEFAULT STATE", "I VALUE PRECISION IN LANGUAGE",
                "LET THE DATA SPEAK FOR ITSELF", "A GOOD THEORY IS A THING OF BEAUTY",
                "I LIVE INSIDE MY OWN HEAD", "SMALL TALK IS A NECESSARY EVIL"
            ];

            let currentQuote = '';
            let substitutionMap = {};
            let userMap = {};
            let selectedCipherChar = null;

            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function createPuzzle() {
                currentQuote = quotes[Math.floor(Math.random() * quotes.length)];
                const shuffledAlphabet = shuffle([...ALPHABET]);
                substitutionMap = {};
                ALPHABET.split('').forEach((char, i) => {
                    substitutionMap[char] = shuffledAlphabet[i];
                });

                userMap = {};
                selectedCipherChar = null;
                messageElement.textContent = '';
                nextPuzzleBtn.style.display = 'none';
                checkBtn.style.display = 'inline-block';
                resetBtn.style.display = 'inline-block';
                hintBtn.style.display = 'inline-block';

                renderPuzzle();
                updateMappingUI();
            }

            function renderPuzzle() {
                quoteElement.innerHTML = '';
                currentQuote.split('').forEach(char => {
                    const wrapper = document.createElement('span');
                    wrapper.className = 'char-wrapper';
                    if (ALPHABET.includes(char)) {
                        const encryptedChar = substitutionMap[char];
                        wrapper.innerHTML = `<span class="cipher-char">${encryptedChar}</span><span class="plain-char" data-original="${encryptedChar}">&nbsp;</span>`;
                    } else {
                        wrapper.innerHTML = `<span class="cipher-char" style="opacity:0;">${char}</span><span class="plain-char">${char}</span>`;
                    }
                    quoteElement.appendChild(wrapper);
                });
            }

            function updateMappingUI() {
                const quoteChars = [...new Set(currentQuote.split('').filter(c => ALPHABET.includes(c)))];
                const cipherChars = quoteChars.map(c => substitutionMap[c]).sort();

                cipherAlphabetElement.innerHTML = '';
                cipherChars.forEach(c => {
                    const charDiv = document.createElement('div');
                    charDiv.className = 'alphabet-char';
                    charDiv.textContent = c;
                    charDiv.dataset.cipher = c;
                    if (userMap[c]) {
                        charDiv.textContent = `${c}→${userMap[c]}`;
                        charDiv.classList.add('used');
                    }
                    if (selectedCipherChar === c) charDiv.classList.add('selected');
                    cipherAlphabetElement.appendChild(charDiv);
                });

                plainAlphabetElement.innerHTML = '';
                const usedPlainChars = Object.values(userMap);
                ALPHABET.split('').forEach(c => {
                    const charDiv = document.createElement('div');
                    charDiv.className = 'alphabet-char';
                    charDiv.textContent = c;
                    charDiv.dataset.plain = c;
                    if (usedPlainChars.includes(c)) charDiv.classList.add('used');
                    plainAlphabetElement.appendChild(charDiv);
                });
                updatePuzzleDisplay();
            }

            function updatePuzzleDisplay() {
                 document.querySelectorAll('#cryptogram-quote .plain-char').forEach(span => {
                    const originalCipher = span.dataset.original;
                    if (originalCipher && userMap[originalCipher]) {
                        span.textContent = userMap[originalCipher];
                    } else {
                        span.innerHTML = '&nbsp;';
                    }
                });
            }

            cipherAlphabetElement.addEventListener('click', e => {
                const target = e.target.closest('.alphabet-char');
                if (!target) return;
                const cipher = target.dataset.cipher;
                if (userMap[cipher]) { // If already mapped, clear it
                    delete userMap[cipher];
                    selectedCipherChar = null;
                } else {
                    selectedCipherChar = cipher;
                }
                updateMappingUI();
            });

            plainAlphabetElement.addEventListener('click', e => {
                const target = e.target.closest('.alphabet-char');
                if (!target || target.classList.contains('used') || !selectedCipherChar) return;
                const plain = target.dataset.plain;
                userMap[selectedCipherChar] = plain;
                selectedCipherChar = null;
                updateMappingUI();
            });

            function checkSolution() {
                let decryptedString = '';
                currentQuote.split('').forEach(char => {
                    if (ALPHABET.includes(char)) {
                        const encryptedChar = substitutionMap[char];
                        decryptedString += userMap[encryptedChar] || '?';
                    } else {
                        decryptedString += char;
                    }
                });

                if (decryptedString === currentQuote) {
                    messageElement.textContent = '정답입니다! 완벽하게 해독했습니다!';
                    messageElement.style.color = 'var(--success-color)';
                    nextPuzzleBtn.style.display = 'inline-block';
                    checkBtn.style.display = 'none';
                    hintBtn.style.display = 'none';
                } else {
                    messageElement.textContent = '아직 미완성입니다. 다시 확인해보세요.';
                    messageElement.style.color = 'var(--error-color)';
                }
            }

            function showHint() {
                const unsolved = Object.keys(substitutionMap).filter(plain => 
                    !Object.values(userMap).includes(plain)
                );
                if (unsolved.length === 0) {
                    messageElement.textContent = '모든 글자를 다 찾았습니다!';
                    return;
                }
                const randomPlain = unsolved[Math.floor(Math.random() * unsolved.length)];
                const correspondingCipher = substitutionMap[randomPlain];
                
                // Clear any existing mapping for the revealed pair
                for(const key in userMap) {
                    if(userMap[key] === randomPlain) delete userMap[key];
                }
                userMap[correspondingCipher] = randomPlain;
                selectedCipherChar = null;
                updateMappingUI();
            }

            checkBtn.addEventListener('click', checkSolution);
            resetBtn.addEventListener('click', () => {
                userMap = {};
                selectedCipherChar = null;
                updateMappingUI();
            });
            hintBtn.addEventListener('click', showHint);
            nextPuzzleBtn.addEventListener('click', createPuzzle);

            createPuzzle();
        });
    </script>
</body>
</html>
>