<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>암호 해독 (크립토그램)</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <style>
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        #cryptogram-quote {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
            font-size: 1.4em;
            letter-spacing: 2px;
            text-align: center;
        }
        .char-wrapper {
            display: inline-block;
            text-align: center;
            margin: 0 2px;
            min-width: 20px;
        }
        .cipher-char {
            font-weight: bold;
            color: var(--h-color);
            display: block;
        }
        .plain-char {
            border-bottom: 2px solid var(--text-color);
            min-height: 24px;
            display: block;
            color: var(--success-color);
            font-weight: normal;
        }
        #alphabet-mapping {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 10px;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }
        .mapping-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--card-bg);
            padding: 5px;
            border-radius: 5px;
            border: 1px solid var(--card-border);
        }
        .mapping-item label {
            font-weight: bold;
        }
        .mapping-item input {
            width: 30px;
            height: 30px;
            text-align: center;
            font-size: 1em;
            border: 1px solid var(--card-border);
            background-color: var(--container-bg);
            color: var(--text-color);
            border-radius: 4px;
            text-transform: uppercase;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        #message {
            width: 100%;
            text-align: center;
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
            min-height: 25px;
        }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">INTP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links">
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">오늘의 INTP</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/daily/">메인</a>
                        <a href="/u/tests/daily/quote/">오늘의 명언</a>
                        <a href="/u/tests/daily/puzzle/">오늘의 논리 퍼즐</a>
                        <a href="/u/tests/daily/thought-experiment/">오늘의 사고실험</a>
                        <a href="/u/tests/daily/weakness-workout/">INTP 약점 단련</a>
                        <a href="/u/tests/daily/featured-idea/">오늘의 아이디어</a>
                        <a href="/u/tests/daily/de-stressor/">오늘의 스트레스 해소법</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">정보</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/info-characteristics/">특징</a>
                        <a href="/u/tests/info-careers/">커리어</a>
                        <a href="/u/tests/info-cognitive-functions/">인지기능</a>
                        <a href="/u/tests/info-subtypes/">하위유형</a>
                        <a href="/u/tests/info-relationships/">인간관계</a>
                        <a href="/u/tests/info-misconceptions/">흔한 오해</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">테스트</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/test-logic-quiz/">논리력 퀴즈</a>
                        <a href="/u/tests/test-relationship-style/">연애 스타일 테스트</a>
                        <a href="/u/tests/test-stress-triggers/">스트레스 테스트</a>
                        <a href="/u/tests/test-brain-utilization/">두뇌 활용 테스트</a>
                        <a href="/u/tests/test-bingo/">빙고 챌린지</a>
                        <a href="/u/tests/test-empathy-quiz/">INTP 공감 퀴즈</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">게임</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/game-logic-puzzle/">논리 퍼즐</a>
                        <a href="/u/tests/game-strategy-simulation/">전략 시뮬레이션</a>
                        <a href="/u/tests/game-code-decryption/">암호 해독</a>
                        <a href="/u/tests/game-abstract-reasoning/">추상적 사고 게임</a>
                        <a href="/u/tests/game-travel-planner/">여행 계획 챌린지</a>
                        <a href="/u/tests/game-maze-challenge/">미로 챌린지</a>
                        <a href="/u/tests/game-code-breaker/">암호 해독기</a>
                        <a href="/u/tests/game-pathfinder/">경로 탐색기</a>
                    </div>
                </div>
            </nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>
    <div class="container">
        <h1>암호 해독 (크립토그램)</h1>
        <p style="text-align:center;">암호문을 보고 알파벳 치환 규칙을 추리하여 원본 메시지를 찾아보세요.</p>
        
        <div class="game-container">
            <div id="cryptogram-quote"></div>
            <div id="alphabet-mapping"></div>
            <div class="controls">
                <button id="check-btn" class="btn btn-primary">정답 확인</button>
                <button id="reset-btn" class="btn">초기화</button>
                <button id="reveal-btn" class="btn">정답 공개</button>
                <button id="next-puzzle-btn" class="btn" style="display: none;">다음 문제</button>
            </div>
            <div id="message"></div>
        </div>
    </div>

    <script src="/assets/js/main.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const quoteElement = document.getElementById('cryptogram-quote');
            const mappingElement = document.getElementById('alphabet-mapping');
            const checkBtn = document.getElementById('check-btn');
            const resetBtn = document.getElementById('reset-btn');
            const revealBtn = document.getElementById('reveal-btn');
            const nextPuzzleBtn = document.getElementById('next-puzzle-btn');
            const messageElement = document.getElementById('message');

            const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const quotes = [
                "LOGIC IS MY PLAYGROUND",
                "I THINK THEREFORE I AM",
                "KNOWLEDGE IS POWER",
                "QUESTION EVERYTHING",
                "ANALYSIS OVER EMOTION",
                "THE ARCHITECT OF IDEAS",
                "CURIOSITY IS MY COMPASS",
                "PATTERNS EMERGE FROM CHAOS",
                "A MIND IS A TERRIBLE THING TO WASTE",
                "INTROVERTED INTUITIVE THINKING PERCEIVING",
                "THE WORLD IS A COMPLEX SYSTEM TO BE UNDERSTOOD",
                "I NEED SOLITUDE TO RECHARGE MY MIND",
                "ENDLESS CURIOSITY FOR THE WIN",
                "SARCASM IS MY SECOND LANGUAGE",
                "OVERTHINKING IS MY DEFAULT STATE",
                "I VALUE PRECISION IN LANGUAGE",
                "LET THE DATA SPEAK FOR ITSELF",
                "A GOOD THEORY IS A THING OF BEAUTY",
                "I LIVE INSIDE MY OWN HEAD",
                "SMALL TALK IS A NECESSARY EVIL"
            ];

            let currentQuote = '';
            let substitutionMap = {};
            let userMap = {};

            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function createPuzzle() {
                currentQuote = quotes[Math.floor(Math.random() * quotes.length)];
                const shuffledAlphabet = shuffle([...ALPHABET]);
                substitutionMap = {};
                ALPHABET.split('').forEach((char, i) => {
                    substitutionMap[char] = shuffledAlphabet[i];
                });

                userMap = {};
                messageElement.textContent = '';
                nextPuzzleBtn.style.display = 'none';
                checkBtn.style.display = 'inline-block';
                resetBtn.style.display = 'inline-block';
                revealBtn.style.display = 'inline-block';

                renderPuzzle();
                renderMappingInputs();
            }

            function renderPuzzle() {
                quoteElement.innerHTML = '';
                currentQuote.split('').forEach(char => {
                    if (ALPHABET.includes(char)) {
                        const encryptedChar = substitutionMap[char];
                        const wrapper = document.createElement('span');
                        wrapper.className = 'char-wrapper';
                        wrapper.innerHTML = `<span class="cipher-char">${encryptedChar}</span><span class="plain-char" data-original="${encryptedChar}">&nbsp;</span>`;
                        quoteElement.appendChild(wrapper);
                    } else {
                        const wrapper = document.createElement('span');
                        wrapper.className = 'char-wrapper';
                        wrapper.innerHTML = `<span class="cipher-char">${char}</span><span class="plain-char">&nbsp;</span>`;
                        quoteElement.appendChild(wrapper);
                    }
                });
            }

            function renderMappingInputs() {
                mappingElement.innerHTML = '';
                ALPHABET.split('').forEach(char => {
                    const item = document.createElement('div');
                    item.className = 'mapping-item';
                    const inputId = `map-input-${char}`;
                    item.innerHTML = `<label for="${inputId}">${char} →</label><input type="text" id="${inputId}" data-char="${char}" maxlength="1">`;
                    mappingElement.appendChild(item);
                });
            }

            function handleMappingUpdate() {
                userMap = {};
                document.querySelectorAll('#alphabet-mapping input').forEach(input => {
                    const cipherChar = input.dataset.char;
                    const plainChar = input.value.toUpperCase();
                    if (plainChar && ALPHABET.includes(plainChar)) {
                        userMap[cipherChar] = plainChar;
                    }
                });

                document.querySelectorAll('#cryptogram-quote .plain-char').forEach(span => {
                    const originalCipher = span.dataset.original;
                    if (originalCipher && userMap[originalCipher]) {
                        span.textContent = userMap[originalCipher];
                    } else {
                        span.innerHTML = '&nbsp;';
                    }
                });
            }

            function checkSolution() {
                let decryptedString = '';
                currentQuote.split('').forEach(char => {
                    if (ALPHABET.includes(char)) {
                        const encryptedChar = substitutionMap[char];
                        decryptedString += userMap[encryptedChar] || '';
                    } else {
                        decryptedString += char;
                    }
                });

                if (decryptedString === currentQuote) {
                    messageElement.textContent = '정답입니다! 완벽하게 해독했습니다!';
                    messageElement.style.color = 'var(--success-color)';
                    nextPuzzleBtn.style.display = 'inline-block';
                    checkBtn.style.display = 'none';
                    resetBtn.style.display = 'none';
                    revealBtn.style.display = 'none';
                } else {
                    messageElement.textContent = '아직 미완성입니다. 다시 확인해보세요.';
                    messageElement.style.color = 'var(--error-color)';
                }
            }

            function resetInputs() {
                document.querySelectorAll('#alphabet-mapping input').forEach(input => input.value = '');
                handleMappingUpdate();
                messageElement.textContent = '';
            }

            function revealAnswer() {
                const reverseMap = {};
                for (const key in substitutionMap) {
                    reverseMap[substitutionMap[key]] = key;
                }
                document.querySelectorAll('#alphabet-mapping input').forEach(input => {
                    const cipherChar = input.dataset.char;
                    input.value = reverseMap[cipherChar] || '';
                });
                handleMappingUpdate();
                checkSolution();
            }

            mappingElement.addEventListener('input', handleMappingUpdate);
            checkBtn.addEventListener('click', checkSolution);
            resetBtn.addEventListener('click', resetInputs);
            revealBtn.addEventListener('click', revealAnswer);
            nextPuzzleBtn.addEventListener('click', createPuzzle);

            createPuzzle();
        });
    </script>
</body>
</html>
>