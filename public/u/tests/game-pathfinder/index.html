<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>경로 탐색기</title>
    <link rel="stylesheet" href="/assets/css/main.css">
    <style>
        #game-grid { display: grid; grid-template-columns: repeat(5, 60px); grid-template-rows: repeat(5, 60px); border: 2px solid var(--h-color); position: relative; background-color: var(--card-bg); }
        .grid-cell { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 1.5em; color: var(--h-color); }
        .grid-line { position: absolute; background-color: var(--card-border); transition: background-color 0.2s; cursor: pointer; }
        .grid-line:hover { background-color: var(--nav-link-hover); }
        .grid-line.drawn { background-color: var(--h-color); }
        .horizontal { width: 60px; height: 4px; transform: translateY(-2px); }
        .vertical { width: 4px; height: 60px; transform: translateX(-2px); }
        #controls { margin-top: 20px; text-align: center; }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">INTP.KR Tests</a>
        <div class="nav-right-section">
                        <nav class="nav-links" id="nav-links">
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">오늘의 INTP</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/daily/">메인</a>
                        <a href="/u/tests/daily/quote/">오늘의 명언</a>
                        <a href="/u/tests/daily/puzzle/">오늘의 논리 퍼즐</a>
                        <a href="/u/tests/daily/thought-experiment/">오늘의 사고실험</a>
                        <a href="/u/tests/daily/weakness-workout/">INTP 약점 단련</a>
                        <a href="/u/tests/daily/featured-idea/">오늘의 아이디어</a>
                        <a href="/u/tests/daily/de-stressor/">오늘의 스트레스 해소법</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">정보</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/info-characteristics/">특징</a>
                        <a href="/u/tests/info-careers/">커리어</a>
                        <a href="/u/tests/info-cognitive-functions/">인지기능</a>
                        <a href="/u/tests/info-subtypes/">하위유형</a>
                        <a href="/u/tests/info-relationships/">인간관계</a>
                        <a href="/u/tests/info-misconceptions/">흔한 오해</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">테스트</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/test-logic-quiz/">논리력 퀴즈</a>
                        <a href="/u/tests/test-relationship-style/">연애 스타일 테스트</a>
                        <a href="/u/tests/test-stress-triggers/">스트레스 테스트</a>
                        <a href="/u/tests/test-brain-utilization/">두뇌 활용 테스트</a>
                        <a href="/u/tests/test-bingo/">빙고 챌린지</a>
                        <a href="/u/tests/test-empathy-quiz/">INTP 공감 퀴즈</a>
                    </div>
                </div>
                <div class="nav-item dropdown">
                    <button class="dropdown-toggle">게임</button>
                    <div class="dropdown-menu">
                        <a href="/u/tests/game-logic-puzzle/">논리 퍼즐</a>
                        <a href="/u/tests/game-strategy-simulation/">전략 시뮬레이션</a>
                        <a href="/u/tests/game-code-decryption/">암호 해독</a>
                        <a href="/u/tests/game-abstract-reasoning/">추상적 사고 게임</a>
                        <a href="/u/tests/game-travel-planner/">여행 계획 챌린지</a>
                        <a href="/u/tests/game-maze-challenge/">미로 챌린지</a>
                        <a href="/u/tests/game-code-breaker/">암호 해독기</a>
                        <a href="/u/tests/game-pathfinder/">경로 탐색기</a>
                    </div>
                </div>
            </nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>
    <div class="container">
        <h1>경로 탐색기 (Pathfinder)</h1>
        <p style="text-align:center;">격자 가장자리를 클릭하여 하나의 연속된 루프를 만드세요.<br>각 셀의 숫자는 해당 셀을 둘러싼 선의 개수를 의미합니다.</p>
        <div style="display:flex; justify-content:center; margin-top:20px;">
            <div id="game-grid"></div>
        </div>
        <div id="controls">
            <button id="check-solution-btn" class="btn btn-primary">정답 확인</button>
            <button id="reset-btn" class="btn">초기화</button>
        </div>
        <div id="message" class="message"></div>
    </div>

    <script src="/assets/js/main.js" defer></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const gridContainer = document.getElementById('game-grid');
        const message = document.getElementById('message');
        const checkBtn = document.getElementById('check-solution-btn');
        const resetBtn = document.getElementById('reset-btn');
        const size = 5;

        // 0=empty, 1,2,3=clue, -1=no clue
        const puzzle = [
            [-1, 3, -1, 3, -1],
            [2, -1, -1, -1, 2],
            [-1, 3, 2, 3, -1],
            [2, -1, -1, -1, 2],
            [-1, 3, -1, 3, -1]
        ];

        let lines = {}; // key: x1,y1,x2,y2

        function drawGrid() {
            gridContainer.innerHTML = '';
            // Draw cells
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    if (puzzle[r][c] !== -1) {
                        cell.textContent = puzzle[r][c];
                    }
                    gridContainer.appendChild(cell);
                }
            }
            // Draw lines
            for (let r = 0; r <= size; r++) {
                for (let c = 0; c <= size; c++) {
                    // Horizontal
                    if (c < size) {
                        const hLine = document.createElement('div');
                        hLine.className = 'grid-line horizontal';
                        hLine.style.top = `${r * 60}px`;
                        hLine.style.left = `${c * 60}px`;
                        hLine.dataset.r1 = r; hLine.dataset.c1 = c; hLine.dataset.r2 = r; hLine.dataset.c2 = c + 1;
                        hLine.addEventListener('click', toggleLine);
                        gridContainer.appendChild(hLine);
                    }
                    // Vertical
                    if (r < size) {
                        const vLine = document.createElement('div');
                        vLine.className = 'grid-line vertical';
                        vLine.style.top = `${r * 60}px`;
                        vLine.style.left = `${c * 60}px`;
                        vLine.dataset.r1 = r; vLine.dataset.c1 = c; vLine.dataset.r2 = r + 1; vLine.dataset.c2 = c;
                        vLine.addEventListener('click', toggleLine);
                        gridContainer.appendChild(vLine);
                    }
                }
            }
        }

        function toggleLine(e) {
            const line = e.target;
            line.classList.toggle('drawn');
            const key = getLineKey(line.dataset);
            if (line.classList.contains('drawn')) {
                lines[key] = true;
            } else {
                delete lines[key];
            }
        }

        function getLineKey({r1, c1, r2, c2}) {
            // Ensure consistent key order
            if (r1 > r2 || (r1 === r2 && c1 > c2)) {
                return `${r2},${c2},${r1},${c1}`;
            }
            return `${r1},${c1},${r2},${c2}`;
        }

        function checkSolution() {
            // 1. Check clues
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    if (puzzle[r][c] === -1) continue;
                    let surroundingLines = 0;
                    if (lines[getLineKey({r1:r, c1:c, r2:r, c2:c+1})]) surroundingLines++; // Top
                    if (lines[getLineKey({r1:r+1, c1:c, r2:r+1, c2:c+1})]) surroundingLines++; // Bottom
                    if (lines[getLineKey({r1:r, c1:c, r2:r+1, c2:c})]) surroundingLines++; // Left
                    if (lines[getLineKey({r1:r, c1:c+1, r2:r+1, c2:c+1})]) surroundingLines++; // Right
                    if (surroundingLines !== puzzle[r][c]) {
                        message.textContent = `(${r}, ${c}) 셀의 힌트(${puzzle[r][c]})가 맞지 않습니다.`;
                        message.style.color = 'var(--error-color)';
                        return;
                    }
                }
            }

            // 2. Check for single loop (simplified check)
            const allLineKeys = Object.keys(lines);
            const points = {};
            allLineKeys.forEach(key => {
                const [r1, c1, r2, c2] = key.split(',').map(Number);
                const p1Key = `${r1},${c1}`;
                const p2Key = `${r2},${c2}`;
                points[p1Key] = (points[p1Key] || 0) + 1;
                points[p2Key] = (points[p2Key] || 0) + 1;
            });

            for (const point in points) {
                if (points[point] !== 2) {
                    message.textContent = '루프가 아니거나 여러 개의 루프가 존재합니다. 모든 선은 2개의 다른 선과 만나야 합니다.';
                    message.style.color = 'var(--error-color)';
                    return;
                }
            }
            
            message.textContent = '정답입니다! 완벽한 루프를 완성했습니다.';
            message.style.color = 'var(--success-color)';
        }

        function resetGrid() {
            lines = {};
            document.querySelectorAll('.grid-line.drawn').forEach(l => l.classList.remove('drawn'));
            message.textContent = '';
        }

        checkBtn.addEventListener('click', checkSolution);
        resetBtn.addEventListener('click', resetGrid);

        drawGrid();
    });
    </script>
</body>
</html>